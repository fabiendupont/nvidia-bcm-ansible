---
# Test inventory for OpenShift Agent-Based Installer deployment via BCM
#
# This demonstrates the two-phase approach:
# Phase 1: GenericDevice with PXE boot for installation
# Phase 2: Convert to LiteNode with agent-based management

all:
  children:
    bcm_headnode:
      hosts:
        bcm-headnode:
          ansible_host: 192.168.122.204
          ansible_user: root
          ansible_python_interpreter: /cm/local/apps/python312/bin/python3.12
          # Use SSH key authentication

      vars:
        # ================================================================
        # Cluster Configuration
        # ================================================================
        cluster_name: test-ocp
        cluster_type: openshift
        openshift_version: "4.20"

        # BCM server IP (internal network - will be detected automatically)
        bcm_server: "10.141.255.254"

        # OpenShift agent ISO path (on BCM head node)
        # This will be auto-generated by Ansible and copied here
        openshift_iso_path: "/root/agent.x86_64.iso"

        # OpenShift pull secret (download from https://console.redhat.com/openshift/install/pull-secret)
        # Save it to ~/pull-secret.json or update path below
        openshift_pull_secret_path: ~/pull-secret.json

        # Kubeconfig for cluster access after installation
        kubeconfig_path: "/root/openshift/auth/kubeconfig"

        # BCM agent Helm chart path
        bcm_agent_helm_chart_path: "/root/nvidia-bcm-lite-daemon/helm/bcm-agent"

        # ================================================================
        # VM Configuration (virtio disks)
        # ================================================================
        install_device: "/dev/vda"  # VMs use virtio disks, not /dev/sda

        # ================================================================
        # Redfish Configuration (for VM testing with sushy-emulator)
        # ================================================================
        redfish_emulator_host: "192.168.1.51"
        redfish_emulator_port: 8000

        # ================================================================
        # Network Configuration
        # ================================================================
        # Nodes will use static IPs configured in install-config.yaml
        # during agent ISO generation

        # ================================================================
        # Node Roles
        # ================================================================
        node_roles:
          - name: master
            category: "openshift_{{ openshift_version | replace('.', '') }}_{{ cluster_name | replace('-', '_') }}_master"

        # ================================================================
        # Test Cluster Nodes (Virtual Machines)
        # ================================================================
        # Minimal compact cluster: 3 control plane nodes
        # (can also run workloads - no dedicated workers needed)
        cluster_nodes:
          - name: ocp-master-0
            ansible_user: core
            mac: "52:54:00:0C:01:00"
            ip: "10.141.160.50"
            role: master

          - name: ocp-master-1
            ansible_user: core
            mac: "52:54:00:0C:01:01"
            ip: "10.141.160.51"
            role: master

          - name: ocp-master-2
            ansible_user: core
            mac: "52:54:00:0C:01:02"
            ip: "10.141.160.52"
            role: master

        # ================================================================
        # OpenShift Configuration
        # ================================================================
        # These will be used during agent ISO generation
        openshift_base_domain: "test.local"
        openshift_cluster_network_cidr: "10.128.0.0/14"
        openshift_cluster_network_host_prefix: 23
        openshift_service_network_cidr: "172.30.0.0/16"
        openshift_machine_network_cidr: "10.141.0.0/16"

        # Virtual IPs for API and Ingress (baremetal platform)
        # These will be managed by keepalived on the control plane nodes
        openshift_api_vips:
          - "10.141.160.100"
        openshift_ingress_vips:
          - "10.141.160.101"

        # Pull secret (get from cloud.redhat.com)
        # openshift_pull_secret_path: "/root/pull-secret.json"

        # SSH public key for core user (will use BCM SSH keys)
        # openshift_ssh_public_key_path: "/root/.ssh/id_rsa.pub"
