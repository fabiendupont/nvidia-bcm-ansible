---
# Test inventory for RHEL+Slurm deployment using BCM's existing image
#
# This test uses the existing default-image in BCM instead of needing a RHEL ISO

all:
  children:
    bcm_headnode:
      hosts:
        bcm-headnode:
          ansible_host: 192.168.122.204
          ansible_user: root
          # Use SSH key authentication (configured already)

      vars:
        # ================================================================
        # Cluster Configuration
        # ================================================================
        cluster_name: test-hpc
        cluster_type: slurm

        # ================================================================
        # RHEL Configuration
        # ================================================================
        rhel_version: "9.6"
        rhel_iso_path: "/root/rhel-9.6-x86_64-dvd.iso"  # Path on BCM headnode
        # rhel_iso_local_path: "/path/to/local/rhel.iso"  # Uncomment if copying from local

        # Root password for installed systems (CHANGE THIS!)
        root_password: "changeme123"

        # BCM server IP (internal network)
        bcm_server: "10.141.255.254"
        bcm_internal_ip: "10.141.255.254"  # IP on internal provisioning network

        # ================================================================
        # Network Configuration
        # ================================================================
        network_bootproto: dhcp
        network_device: link
        network_onboot: true

        # ================================================================
        # Disk Configuration
        # ================================================================
        disk_device: vda  # VMs typically use virtio (vda) instead of sda
        disk_clearpart: true
        disk_autopart_type: lvm

        # ================================================================
        # Node Roles
        # ================================================================
        node_roles:
          # Test compute node
          - name: compute
            category: "slurm-{{ cluster_name }}-compute"
            packages:
              - "@^minimal-environment"
              - nfs-utils
              - vim-enhanced
            post_script: |
              # Test post-installation script
              echo "Test compute node configured at $(date)" > /root/test-install.log
              # Configure basic NFS (will fail gracefully if no NFS server)
              echo "# bcm-headnode:/home /home nfs defaults,_netdev 0 0" >> /etc/fstab
              echo "Installation completed successfully" >> /root/test-install.log

        # ================================================================
        # VM Configuration (for test environments)
        # ================================================================
        vm_memory_mb: 4096
        vm_vcpus: 2
        vm_disk_gb: 40
        vm_network: "bcm-internalnet"
        skip_vm_creation: false

        # ================================================================
        # Redfish Power Management (Sushy Emulator)
        # ================================================================
        sushy_host: "192.168.122.1"  # Hypervisor host IP
        sushy_port: 8000

        # ================================================================
        # Test Cluster Nodes (Virtual Machines)
        # ================================================================
        # Note: These are test VMs - adjust MAC/IP based on your VM setup
        cluster_nodes:
          - name: test-compute-01
            ansible_user: root
            mac: "52:54:00:AA:01:01"
            ip: "10.141.100.101"
            category: "slurm-{{ cluster_name }}-compute"
            hostname: "test-compute-01.{{ cluster_name }}.local"
            # Redfish power management via Sushy Emulator
            redfish_enabled: true
            redfish_host: "{{ sushy_host }}"
            redfish_port: "{{ sushy_port }}"
            redfish_system_id: "0c8ddfff-1592-4cfc-8d60-b430c2589957"
