---
# Register nodes in BCM with MAC-based Ignition URLs

- name: Build category name for each node
  ansible.builtin.set_fact:
    node_category_map: "{{ node_category_map | default({}) | combine({item.name: 'openshift_' + (openshift_version | replace('.', '')) + '_' + (cluster_name | replace('-', '_')) + '_' + item.role}) }}"
  loop: "{{ cluster_nodes }}"
  loop_control:
    label: "{{ item.name }}"

- name: Register OpenShift cluster nodes
  brightcomputing.bcm110.physical_node:
    hostname: "{{ item.name }}"
    state: present
    mac: "{{ item.mac }}"
    category: "{{ node_category_map[item.name] }}"
    partition: "base"
    provisioningInterface: "BOOTIF"
    interfaces_NetworkPhysicalInterface:
      - name: "BOOTIF"
        ip: "{{ item.ip }}"
        network: "internalnet"
  loop: "{{ cluster_nodes }}"
  loop_control:
    label: "{{ item.name }}"
